console.log("[import] git: 04f978740273620ebfe4bd2f3e43d26dec1cf05d, stamp: 7BCD26B77F5043A0");
!function(){var e=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};let t,r=e=>{};function n(e){t=e}function o(e){r=e}function i(e){r(e)}let s=!1;function a(){console.log("cancelConversion"),s=!0,m&&(m.terminate(),m=null),f&&(f=null);for(let e in w){let t=w[e];delete w[e],t.reject(new Error("Canceled import."))}}function l(){return s}function c(){s=!1}function u(e,t){let r=e.dataTransfer,n=Array.prototype.forEach;function o(e,r){l()||t(r,e)}if(c(),r.items){let e=!1;if(n.call(r.items,t=>{if(t.webkitGetAsEntry){let r=t.webkitGetAsEntry();if(r){let t=r.name;r.isDirectory?r.getFile("Data",null,e=>e.file(e=>o(e,t))):r.isFile&&r.file(e=>o(e,t)),e=!0}}}),e)return}n.call(r.files,e=>o(e,e.name))}let f=null,d=!0;function p(){d=!1}function g(){if(!f){let e=t||"import.worker.js",r=e=>{try{m=new Worker(e)}catch(e){throw f=null,new Error("Failed to load the web worker. Please contact Figma for support.")}return m.onmessage=b,m};f=d?function(e,t){return new Promise((r,n)=>{let o=new XMLHttpRequest;o.onload=()=>{o.status>=200&&o.status<400&&r(o.response)},o.onloadend=()=>{n(new Error("Failed to download the file importer. Please make sure you're connected to the internet and try again."))},o.open("GET",e),o.responseType=t,o.send(null)})}(e,"blob").then(e=>r(URL.createObjectURL(e))):new Promise((t,n)=>{t(r(e))})}return f}let m=null,w={},y=0;function b(e){let t=e.data;switch(t.type){case"ConversionFailureResponse":{let e=t;if(e.id in w){let t=w[e.id];delete w[e.id];let r=e.error;r.inferredFormat=e.inferredFormat,r.warnings=e.warnings,r.reportError=e.reportError,e.originalError&&(r.cause=e.originalError),t.reject(r)}break}case"ConversionSuccessResponse":{let e=t;if(e.id in w){let t=w[e.id];delete w[e.id],l()?(r(100),t.reject(new Error("Import canceled"))):(r(20),t.resolve(e.result))}break}case"UpdateProgressMessage":{let e=t;r&&r(e.percentage);break}case"LoadFontMessage":{let r=t,n=w[r.id];(n&&n.fontLoader?n.fontLoader.getFont(r.postscript):Promise.reject(null)).then(t=>{let n={type:"FontLoadedMessage",id:r.id,postscript:r.postscript,result:t};e.target.postMessage(n,[t.font.buffer])}).catch(()=>{let t={type:"FontLoadedMessage",id:r.id,postscript:r.postscript,result:null};e.target.postMessage(t)});break}default:console.warn("import shim got unsupported message: "+t.type)}}function h(e,t){if(e.length<t.length)return!1;for(let r=0;r<t.length;r++)if(e[r]!==t[r])return!1;return!0}function F(e){return g().then(t=>new Promise((r,n)=>{let o=e.message.id;w[o]={resolve:r,reject:n,fontLoader:e.fontLoader},t.postMessage(e.message,e.buffers)}))}function E({blob:t,featureFlags:r,fontLoader:n,isUserFigmaEmployee:o,fileExtension:i}){return e(this,void 0,void 0,(function*(){if(!l()){const e=new Uint8Array(yield t.slice(0,20).arrayBuffer());if(v(e)||P(e)){let e=URL.createObjectURL(t);const r=new Image,o=new Promise((e,t)=>{r.onerror=()=>{t({message:"Invalid image",stack:(new Error).stack})},r.onload=e});r.src=e,yield o;const i=new Uint8Array(yield t.arrayBuffer()),s={type:"ImageConversionRequest",id:y++,bytes:i,width:r.width,height:r.height};return yield F({message:s,buffers:[i.buffer],fontLoader:n})}const s={type:"FileConversionRequest",id:y++,blob:t,featureFlags:r,isUserFigmaEmployee:o,fileExtension:i};return yield F({message:s,buffers:[],fontLoader:n})}return{file:null,videos:[],images:[],warnings:[]}}))}function v(e){return h(e,[137,80,78,71,13,10,26,10])}function P(e){return h(e,[255,216])}function k(e){return h(e,[71,73,70,56,55,97])||h(e,[71,73,70,56,57,97])}window.createFileImporter=e=>(delete window.createFileImporter,n(e),{convertFile:E,disableWorkerBlob:p,cancelConversion:a,hasCanceled:l,resetCancel:c,setUpdateProgressCallback:o,callUpdateProgressCallback:i,extractFilesFromDropEvent:u,isProbablyJPEGFile:P,isProbablyPNGFile:v,isProbablyGIFFile:k})}();
